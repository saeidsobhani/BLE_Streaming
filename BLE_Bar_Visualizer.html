<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bangle.js BLE Bar Visualizer</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f5f5f5; }
        .sensor { margin: 20px 0; padding: 10px; background-color: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .bar-container { position: relative; width: 400px; height: 30px; background-color: #e0e0e0; border-radius: 15px; margin: 10px 0; }
        .bar { position: absolute; height: 100%; background: linear-gradient(90deg, #ff6b6b, #4ecdc4); border-radius: 15px; transition: all 0.1s ease; }
        .value { font-weight: bold; font-size: 14px; margin-left: 10px; }
        .axis-label { font-weight: bold; margin-bottom: 5px; }
        button { padding: 10px 20px; background-color: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer; margin: 10px; }
        button:hover { background-color: #45a049; }
        #status { margin: 10px; font-weight: bold; }
    </style>
</head>
<body>
    <h1>Bangle.js BLE Sensor Bar Visualizer</h1>
    <button id="connectBtn">Connect to Bangle.js</button>
    <div id="status">Disconnected</div>

    <div class="sensor">
        <h2>Accelerometer (g)</h2>
        <div class="axis-label">X:</div>
        <div class="bar-container"><div id="accelXBar" class="bar"></div></div>
        <div class="value">Value: <span id="accelX">0.00</span></div>

        <div class="axis-label">Y:</div>
        <div class="bar-container"><div id="accelYBar" class="bar"></div></div>
        <div class="value">Value: <span id="accelY">0.00</span></div>

        <div class="axis-label">Z:</div>
        <div class="bar-container"><div id="accelZBar" class="bar"></div></div>
        <div class="value">Value: <span id="accelZ">0.00</span></div>
    </div>

    <div class="sensor">
        <h2>Magnetometer (ÂµT)</h2>
        <div class="axis-label">X:</div>
        <div class="bar-container"><div id="magXBar" class="bar"></div></div>
        <div class="value">Value: <span id="magX">0</span></div>

        <div class="axis-label">Y:</div>
        <div class="bar-container"><div id="magYBar" class="bar"></div></div>
        <div class="value">Value: <span id="magY">0</span></div>

        <div class="axis-label">Z:</div>
        <div class="bar-container"><div id="magZBar" class="bar"></div></div>
        <div class="value">Value: <span id="magZ">0</span></div>
    </div>

    <script>
        let device, server, service, magChar, accelChar;

        const serviceUUID = 'f8b23a4d-89ad-4220-8c9f-d81756009f0c';
        const magUUID = 'f8b23a4d-89ad-4220-8c9f-d81756009f0c';
        const accelUUID = 'f8b23a4d-89ad-4220-8c9f-d81756009f0d';

        document.getElementById('connectBtn').addEventListener('click', connect);

        async function connect() {
            if (!('bluetooth' in navigator)) {
                alert('Web Bluetooth is not supported in this browser. Please use Chrome or Edge.');
                return;
            }

            try {
                device = await navigator.bluetooth.requestDevice({
                    acceptAllDevices: true,
                    optionalServices: [serviceUUID]
                });
                server = await device.gatt.connect();
                service = await server.getPrimaryService(serviceUUID);
                magChar = await service.getCharacteristic(magUUID);
                accelChar = await service.getCharacteristic(accelUUID);

                await magChar.startNotifications();
                await accelChar.startNotifications();

                magChar.addEventListener('characteristicvaluechanged', handleMagData);
                accelChar.addEventListener('characteristicvaluechanged', handleAccelData);

                document.getElementById('status').textContent = 'Connected to ' + device.name;
                document.getElementById('connectBtn').disabled = true;
            } catch (error) {
                console.error('Connection failed:', error);
                document.getElementById('status').textContent = 'Connection failed: ' + error.message;
            }
        }

        function handleMagData(event) {
            const data = new Int32Array(event.target.value.buffer);
            updateBar('magX', data[0], -1000, 1000);
            updateBar('magY', data[1], -1000, 1000);
            updateBar('magZ', data[2], -1000, 1000);
        }

        function handleAccelData(event) {
            const data = new Float32Array(event.target.value.buffer);
            updateBar('accelX', data[0], -2, 2);
            updateBar('accelY', data[1], -2, 2);
            updateBar('accelZ', data[2], -2, 2);
        }

        function updateBar(axis, value, min, max) {
            const bar = document.getElementById(axis + 'Bar');
            const valueSpan = document.getElementById(axis);
            valueSpan.textContent = value.toFixed(axis.startsWith('accel') ? 2 : 0);

            // Normalize value to 0-100% for bar width
            const normalized = ((value - min) / (max - min)) * 100;
            const clamped = Math.max(0, Math.min(100, normalized));
            bar.style.width = clamped + '%';

            // Color based on value (red for negative, green for positive)
            if (value < 0) {
                bar.style.background = 'linear-gradient(90deg, #ff6b6b, #ff9999)';
            } else {
                bar.style.background = 'linear-gradient(90deg, #4ecdc4, #7dd3c0)';
            }
        }
    </script>
</body>
</html>
